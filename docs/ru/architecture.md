# Архитектура микросервиса FileFerry

## Для чего он?
По большей части он - мой Магнум Опус со времен, когда я был совсем зелёным в этой сфере.
Я просто хотел придумать качественное решение для работы с файлами :) .

## Назначение
Микросервис предоставляет CRUD для работы с файлами, абстрагируя работу с хранилищем и базой.

## Стэк
- FastAPI
- PostgreSQL(SQLAlchemy)
- MiniO(S3 Storage)
- Python 3.12R
- Вдохновлено **Domain-Driven Design**
- И конечно же **Hexagonal Architecture**

## Архитектурный стиль
Выбран по понятным причинам "Порты и адаптеры" с четким разбиением на слои:

                    +---------------------------+
                    |       Transport Layer      |
                    |     (FastAPI, DTOs, DI)     |
                    +-------------+--------------+
                                  |
                    +-------------v--------------+
                    |     Application Layer       |
                    | (UseCases + Adapters + UoW)  |
                    +-------------+--------------+
                                  |
                    +-------------v--------------+
                    |         Domain Layer        |
                    | (Entities, ValueObjects,    |
                    |  Policies, Domain Services) |
                    +-------------+--------------+
                                  |
          +----------+------------+-------------+-----------+
          |          |                          |           |
+---------v-+  +------v-------+        +---------v-+   +-----v-------+
| Postgres  |  | MinIO Storage|        | (Future)  |   | (Future)    |
| SQL Repo  |  | File Storage |        | MongoDB   |   | SFTP Client |
| Adapter   |  | Adapter      |        | Adapter   |   | Adapter     |
+-----------+  +--------------+        +-----------+   +------------+


## Основные компоненты.

- **UseCase** -- реализует конкретный бизнес-сценарий. Работает с Domain моделями, в том числе умеет создавать их из примитивов через фабрику.
- **Adapters** -- реализует конракты (протоколы) для работы с БД, S3 и т.д
- **Domain** -- ядро, реализует бизнес-правилы через классы, чистые бизнес модели, постороенные на value objects.
- **Transport** -- роутеры, DTO, валидации. Не хранит в себе логики. Умеет проверить соответствие input data под требования value objects.
- **Shared** -- содержит общие зависимости, классы ошибок, логирование, enum'ы.

## Принципы
- Слои не зависят друг от друга "вниз".
- Ни один слой не завязан на конкретной реализации.
- Вся именно валидация происходит на уровне transport, далее только проверка уровня "бизнес-правила"
- Domain строго изолирован от всех деталей реализации и технологий, чистые dataclass сущности.

