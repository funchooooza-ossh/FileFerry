# Composition Layer

Этот слой отвечает за концентрацию всей инфраструктурной сложности проекта. Он является центральной точкой сборки и внедрения всех зависимостей в микросервисе. Composition Layer управляет созданием, композицией и связкой всех инфраструктурных компонентов, сервисов и адаптеров.

## 🛠️ Назначение

Composition Layer реализует:
- Управление зависимостями через DI-контейнеры.
- Инициализацию всех инфраструктурных компонентов: баз данных, кэшей, адаптеров.
- Сборку всех слоёв проекта в единое целое.
- Централизованное управление фабриками и контейнерами.

## 🧩 Архитектурные принципы

### 1. Инверсия зависимостей (DIP)
Composition Layer — основная точка инверсии зависимостей. Он изолирует приложение от конкретных реализаций, позволяя менять инфраструктуру без изменений в бизнес-логике.

### 2. Централизованное управление
Вся инфраструктурная сложность концентрируется здесь, чтобы изолировать её от слоёв приложения и домена. Это делает проект гибким к изменениям и лёгким в поддержке.

### 3. Автоматическое связывание
Все зависимости настраиваются через DI-контейнеры с использованием библиотеки `dependency-injector`. Благодаря этому слои приложения остаются независимыми от инфраструктурных деталей.

## 🚀 Основные преимущества

- **Гибкость и модульность**: Лёгкость замены инфраструктурных компонентов без изменения логики приложения.
- **Минимизация связности**: Проект не зависит от конкретной реализации баз данных или кэша.
- **Централизованная сборка**: Все зависимости настраиваются в одном месте, уменьшая хаос конфигурации.

## 💡 Как использовать

Контейнеры автоматически создают нужные объекты при запуске приложения:
1. Инициализация контейнера в точке входа:
   ```python
   from composition.di import AppContainer
   container = AppContainer()
2. Привязка готового контейнера к нужному контексту:
    ``` python
        app = FastAPI()
        container = ApplicationContainer()
        app.state.container = container
    ```
    после этого:
    ``` python
        async def endpoint(request: Request, *args: Any, **kwargs) -> Any:
            container = request.app.state.container
            await container.foo.execute(*args, **kwargs)
